<div class="min-h-screen bg-[#f6f8f7] font-display text-[#0e1b13] flex flex-col">

  <header class="bg-white border-b border-[#e7f3ec] px-8 py-6 flex flex-col gap-6 sticky top-0 z-40 shadow-sm">
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
      <div class="flex items-center gap-4">
        <button (click)="goBack()" class="size-10 flex items-center justify-center rounded-full bg-white border border-gray-200 text-gray-400 hover:text-[#30e87a] hover:border-[#30e87a] transition-all shadow-sm">
          <span class="material-symbols-outlined font-bold">arrow_back</span>
        </button>
        <div>
          <h1 class="text-3xl font-black tracking-tight">Examination & Grading</h1>
          <p class="text-[#4e976b] text-sm font-medium mt-1">Manage schedules and student results</p>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <button (click)="exportToPDF()" class="flex items-center gap-2 px-4 py-2.5 bg-white border border-[#d0e7d9] rounded-xl text-sm font-bold hover:bg-gray-50 transition-colors shadow-sm text-[#0e1b13]">
          <span class="material-symbols-outlined text-[18px]">file_download</span> Export Report
        </button>
        <button class="flex items-center gap-2 px-4 py-2.5 bg-[#30e87a] text-[#0e1b13] rounded-xl text-sm font-bold shadow-sm hover:bg-[#2bd16e] transition-colors shadow-green-200">
          <span class="material-symbols-outlined text-[18px]">add</span> Create Event
        </button>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="bg-[#e7f3ec] p-5 rounded-2xl border border-green-100 relative overflow-hidden">
        <div class="absolute right-4 top-4 p-2 bg-white/60 rounded-lg"><span class="material-symbols-outlined text-green-700">calendar_month</span></div>
        <p class="text-xs font-bold text-green-800 uppercase tracking-widest opacity-70">Upcoming Exams</p>
        <p class="text-3xl font-black mt-1">12 <span class="text-xs font-bold bg-white/60 px-2 py-0.5 rounded-full text-green-700 ml-2">+2 this week</span></p>
        <div class="w-full bg-green-200/50 h-1.5 rounded-full mt-4"><div class="bg-green-600 h-1.5 rounded-full w-3/4"></div></div>
      </div>
      <div class="bg-[#ffe4e6] p-5 rounded-2xl border border-pink-100 relative overflow-hidden">
        <div class="absolute right-4 top-4 p-2 bg-white/60 rounded-lg"><span class="material-symbols-outlined text-pink-600">pending_actions</span></div>
        <p class="text-xs font-bold text-pink-800 uppercase tracking-widest opacity-70">Pending Approvals</p>
        <p class="text-3xl font-black mt-1">5 <span class="text-xs font-bold bg-white/60 px-2 py-0.5 rounded-full text-pink-600 ml-2">Urgent</span></p>
        <div class="w-full bg-pink-200/50 h-1.5 rounded-full mt-4"><div class="bg-pink-500 h-1.5 rounded-full w-1/3"></div></div>
      </div>
      <div class="bg-[#e0f2fe] p-5 rounded-2xl border border-blue-100 relative overflow-hidden">
        <div class="absolute right-4 top-4 p-2 bg-white/60 rounded-lg"><span class="material-symbols-outlined text-blue-600">tune</span></div>
        <p class="text-xs font-bold text-blue-800 uppercase tracking-widest opacity-70">Active Scales</p>
        <p class="text-3xl font-black mt-1">4 <span class="text-xs font-bold bg-white/60 px-2 py-0.5 rounded-full text-blue-600 ml-2">Updated</span></p>
        <div class="w-full bg-blue-200/50 h-1.5 rounded-full mt-4"><div class="bg-blue-500 h-1.5 rounded-full w-full"></div></div>
      </div>
    </div>

    <div class="flex flex-wrap gap-4 bg-white p-2 rounded-2xl border border-[#e7f3ec] shadow-sm items-center">
      <select [(ngModel)]="selectedYear" (change)="loadStudentList()" class="px-4 py-2.5 bg-[#f6f8f7] border-none rounded-xl text-sm font-bold text-[#0e1b13] focus:ring-2 focus:ring-[#30e87a] cursor-pointer outline-none min-w-[180px]">
        <option value="" disabled selected>Select Category Year</option>
        <option *ngFor="let y of years" [value]="y">{{y}}</option>
      </select>

      <select [(ngModel)]="selectedSubject" (change)="loadStudentList()" class="px-4 py-2.5 bg-[#f6f8f7] border-none rounded-xl text-sm font-bold text-[#0e1b13] focus:ring-2 focus:ring-[#30e87a] cursor-pointer outline-none min-w-[180px]">
        <option value="" disabled selected>Select Subject</option>
        <option *ngFor="let s of subjects" [value]="s">{{s}}</option>
      </select>

      <div class="ml-auto text-xs font-bold text-gray-400 px-4">
        {{ students.length > 0 ? students.length + ' Students Found' : 'Select options to view students' }}
      </div>
    </div>
  </header>

  <div class="flex-1 overflow-y-auto px-8 py-8">
    <div *ngIf="students.length > 0; else emptyState" class="bg-white rounded-[2rem] border border-[#e7f3ec] shadow-sm overflow-hidden">
      <table class="w-full text-left border-collapse">
        <thead class="bg-[#f8fcfa] border-b border-[#e7f3ec]">
        <tr>
          <th class="py-5 px-8 text-xs font-bold text-[#4e976b] uppercase tracking-widest">Student Name</th>
          <th class="py-5 px-8 text-xs font-bold text-[#4e976b] uppercase tracking-widest">Student ID</th>
          <th class="py-5 px-8 text-xs font-bold text-[#4e976b] uppercase tracking-widest">Mark (0-100)</th>
          <th class="py-5 px-8 text-xs font-bold text-[#4e976b] uppercase tracking-widest">Grade</th>
          <th class="py-5 px-8 text-xs font-bold text-[#4e976b] uppercase tracking-widest">Status</th>
          <th class="py-5 px-8 text-xs font-bold text-[#4e976b] uppercase tracking-widest text-right">Action</th>
        </tr>
        </thead>
        <tbody class="divide-y divide-[#e7f3ec]">
        <tr *ngFor="let s of students" class="hover:bg-[#fcfdfd] transition-colors group">
          <td class="py-5 px-8">
            <div class="flex items-center gap-3">
              <div class="size-9 rounded-full bg-[#e7f3ec] flex items-center justify-center text-[#30e87a] font-bold text-xs border border-green-100">{{s.name.charAt(0)}}</div>
              <span class="font-bold text-sm">{{s.name}}</span>
            </div>
          </td>
          <td class="py-5 px-8 text-sm font-mono text-gray-500">{{s.id}}</td>

          <td class="py-5 px-8">
            <input *ngIf="s.isEditing" [(ngModel)]="s.mark" type="number" min="0" max="100" class="w-20 bg-[#f6f8f7] border border-[#d0e7d9] rounded-lg px-2 py-1 text-sm font-bold outline-none focus:ring-2 focus:ring-[#30e87a]">
            <span *ngIf="!s.isEditing" class="font-black text-sm">{{s.mark}}</span>
          </td>

          <td class="py-5 px-8">
              <span [class]="s.grade.startsWith('A') ? 'text-green-600 bg-green-50' : (s.grade === 'F' ? 'text-red-600 bg-red-50' : 'text-blue-600 bg-blue-50')" class="px-3 py-1 rounded-lg text-xs font-black">
                {{s.grade}}
              </span>
          </td>

          <td class="py-5 px-8">
            <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">{{s.status}}</span>
          </td>

          <td class="py-5 px-8 text-right">
            <button (click)="toggleEdit(s)" [class]="s.isEditing ? 'text-[#30e87a] bg-green-50' : 'text-gray-400 hover:text-gray-600'" class="p-2 rounded-xl transition-all">
              <span class="material-symbols-outlined text-[20px]">{{ s.isEditing ? 'check_circle' : 'edit' }}</span>
            </button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <ng-template #emptyState>
      <div class="flex flex-col items-center justify-center h-96 bg-white rounded-[2rem] border border-[#e7f3ec] border-dashed">
        <span class="material-symbols-outlined text-6xl text-[#e7f3ec]">grading</span>
        <p class="text-gray-400 font-bold mt-4 text-sm uppercase tracking-widest">Select Year & Subject to View Students</p>
      </div>
    </ng-template>

    <div class="mt-8 flex justify-end pb-12" *ngIf="students.length > 0">
      <button (click)="submitAllGrades()" class="px-12 py-4 bg-[#30e87a] text-[#0e1b13] font-black uppercase tracking-widest rounded-full shadow-lg shadow-green-200 hover:scale-105 transition-all flex items-center gap-3 text-xs">
        <span class="material-symbols-outlined text-lg">save</span> Submit All Grades
      </button>
    </div>
  </div>
</div>
