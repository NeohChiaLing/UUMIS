<div class="min-h-screen bg-[#f6f8f7] font-display text-[#0e1b13] flex flex-col relative">

  <div *ngIf="showMCConfirm" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/30 backdrop-blur-sm p-6 animate-fade-in">
    <div class="bg-white w-full max-w-sm p-8 rounded-[2rem] shadow-2xl text-center space-y-6">
      <h4 class="text-xl font-black text-emerald-900 uppercase">Manage MC Document</h4>
      <p class="text-sm text-gray-500">Selected: {{clickedStudent?.mcFile}}</p>
      <div class="flex gap-3">
        <button (click)="previewMC()" class="flex-1 py-3 bg-blue-50 text-blue-600 font-bold rounded-xl hover:bg-blue-100">Preview</button>
        <button (click)="downloadMC()" class="flex-1 py-3 bg-emerald-500 text-white font-bold rounded-xl shadow-lg hover:bg-emerald-600">Download</button>
      </div>
      <button (click)="showMCConfirm = false" class="text-xs text-gray-400 font-bold uppercase mt-4">Cancel</button>
    </div>
  </div>

  <div *ngIf="isViewingMC" class="fixed inset-0 z-[110] flex items-center justify-center bg-black/50 p-10">
    <div class="bg-white w-full h-full rounded-2xl flex flex-col overflow-hidden">
      <div class="p-4 border-b flex justify-between items-center">
        <h3 class="font-bold">MC Preview</h3>
        <button (click)="isViewingMC = false" class="text-red-500 font-bold">Close</button>
      </div>
      <iframe [src]="currentMCUrl" class="flex-1 w-full border-none"></iframe>
    </div>
  </div>

  <div *ngIf="isAddingStudent" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/30 backdrop-blur-sm p-6">
    <div class="bg-white w-full max-w-md p-8 rounded-[2rem] shadow-2xl space-y-6">
      <h3 class="text-xl font-black text-emerald-900 uppercase">Add New Student</h3>
      <div class="space-y-4">
        <div><label class="text-xs font-bold text-gray-400">Student Name</label><input [(ngModel)]="newStudent.name" class="w-full mt-1 p-3 bg-gray-50 rounded-xl border border-gray-200 font-bold outline-none focus:border-emerald-500"></div>
        <div><label class="text-xs font-bold text-gray-400">Student ID</label><input [(ngModel)]="newStudent.id" class="w-full mt-1 p-3 bg-gray-50 rounded-xl border border-gray-200 font-bold outline-none focus:border-emerald-500"></div>
      </div>
      <div class="flex gap-3">
        <button (click)="toggleAddStudent()" class="flex-1 py-3 bg-gray-100 text-gray-500 font-bold rounded-xl">Cancel</button>
        <button (click)="saveNewStudent()" class="flex-1 py-3 bg-emerald-500 text-white font-bold rounded-xl shadow-lg">Save Student</button>
      </div>
    </div>
  </div>

  <header class="bg-white border-b border-[#e7f3ec] px-8 py-6 flex flex-col gap-6 sticky top-0 z-40 shadow-sm">
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
      <div class="flex items-center gap-4">
        <button (click)="goBack()" class="size-10 flex items-center justify-center rounded-full bg-white border border-gray-200 text-gray-400 hover:text-[#30e87a] hover:border-[#30e87a] transition-all shadow-sm">
          <span class="material-symbols-outlined font-bold">arrow_back</span>
        </button>
        <div>
          <h1 class="text-3xl font-black tracking-tight">Attendance Overview</h1>
          <p class="text-[#4e976b] text-sm font-medium mt-1">Manage daily records & logs</p>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <button (click)="exportToPDF()" class="flex items-center gap-2 px-4 py-2.5 bg-white border border-[#d0e7d9] rounded-xl text-sm font-bold hover:bg-gray-50 transition-colors shadow-sm text-[#0e1b13]">
          <span class="material-symbols-outlined text-[18px]">file_download</span> Export Report (PDF)
        </button>
        <button (click)="toggleAddStudent()" class="flex items-center gap-2 px-4 py-2.5 bg-emerald-500 text-white rounded-xl text-sm font-bold hover:bg-emerald-600 transition-colors shadow-lg shadow-emerald-200">
          <span class="material-symbols-outlined text-[18px]">add</span> Add Student
        </button>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="bg-white p-5 rounded-2xl border border-[#d0e7d9] relative overflow-hidden"><p class="text-xs font-bold text-[#4e976b] uppercase tracking-widest">Total Present</p><p class="text-3xl font-black mt-1 text-[#0e1b13]">845</p></div>
      <div class="bg-white p-5 rounded-2xl border border-pink-100 relative overflow-hidden"><p class="text-xs font-bold text-pink-600 uppercase tracking-widest">Total Absent</p><p class="text-3xl font-black mt-1 text-[#0e1b13]">12</p></div>
      <div class="bg-white p-5 rounded-2xl border border-blue-100 relative overflow-hidden"><p class="text-xs font-bold text-blue-600 uppercase tracking-widest">Late Arrivals</p><p class="text-3xl font-black mt-1 text-[#0e1b13]">5</p></div>
    </div>

    <div class="flex flex-col lg:flex-row gap-4 bg-white p-4 rounded-2xl border border-[#e7f3ec] shadow-sm items-center">
      <div class="flex flex-col gap-1 w-full lg:w-auto"><label class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">Category Year</label><select [(ngModel)]="selectedYear" (change)="filterStudents()" class="px-4 py-2.5 bg-[#f6f8f7] border-none rounded-xl text-sm font-bold text-[#0e1b13] focus:ring-2 focus:ring-[#30e87a] cursor-pointer outline-none min-w-[180px]"><option *ngFor="let y of years" [value]="y">{{y}}</option></select></div>
      <div class="flex flex-col gap-1 w-full lg:w-auto"><label class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">Period Type</label><select [(ngModel)]="selectedPeriod" class="px-4 py-2.5 bg-[#f6f8f7] border-none rounded-xl text-sm font-bold text-[#0e1b13] focus:ring-2 focus:ring-[#30e87a] cursor-pointer outline-none min-w-[120px]"><option *ngFor="let p of timePeriods" [value]="p">{{p}}</option></select></div>
      <div class="flex flex-col gap-1 w-full lg:w-auto"><label class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">Select Date</label><input *ngIf="selectedPeriod === 'Day'" type="date" [(ngModel)]="selectedDate" class="px-4 py-2.5 bg-[#f6f8f7] border-none rounded-xl text-sm font-bold text-[#0e1b13] outline-none min-w-[180px]"><input *ngIf="selectedPeriod === 'Month'" type="month" [(ngModel)]="selectedMonth" class="px-4 py-2.5 bg-[#f6f8f7] border-none rounded-xl text-sm font-bold text-[#0e1b13] outline-none min-w-[180px]"><select *ngIf="selectedPeriod === 'Year'" [(ngModel)]="selectedYearVal" class="px-4 py-2.5 bg-[#f6f8f7] border-none rounded-xl text-sm font-bold text-[#0e1b13] outline-none min-w-[180px]"><option value="2025">2025</option><option value="2024">2024</option></select></div>
      <div class="flex flex-col gap-1 w-full lg:flex-1"><label class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">Find Student</label><div class="relative w-full"><span class="absolute left-3 top-1/2 -translate-y-1/2 material-symbols-outlined text-gray-400 text-sm">search</span><input [(ngModel)]="searchQuery" (input)="filterStudents()" type="text" placeholder="Search by Name or ID..." class="w-full pl-9 pr-4 py-2.5 bg-[#f6f8f7] border-none rounded-xl text-sm font-bold text-[#0e1b13] focus:ring-2 focus:ring-[#30e87a] outline-none"></div></div>
    </div>
  </header>

  <div class="flex-1 overflow-y-auto px-8 py-8">
    <div class="bg-white rounded-[2rem] border border-[#e7f3ec] shadow-sm overflow-hidden">
      <table class="w-full text-left border-collapse">
        <thead class="bg-[#f8fcfa] border-b border-[#e7f3ec]">
        <tr>
          <th class="py-5 px-6 text-xs font-bold text-[#4e976b] uppercase tracking-widest w-16 text-center">No.</th>
          <th class="py-5 px-6 text-xs font-bold text-[#4e976b] uppercase tracking-widest">Student</th>
          <th class="py-5 px-6 text-xs font-bold text-[#4e976b] uppercase tracking-widest">ID Number</th>
          <th class="py-5 px-6 text-xs font-bold text-[#4e976b] uppercase tracking-widest">Time In</th>
          <th class="py-5 px-6 text-xs font-bold text-[#4e976b] uppercase tracking-widest">Status</th>
          <th class="py-5 px-6 text-xs font-bold text-[#4e976b] uppercase tracking-widest text-right">Actions</th>
        </tr>
        </thead>
        <tbody class="divide-y divide-[#e7f3ec]">
        <tr *ngFor="let s of filteredStudents; let i = index" class="hover:bg-[#fcfdfd] transition-colors group">
          <td class="py-5 px-6 text-center text-sm font-bold text-gray-400">{{i + 1}}</td>

          <td class="py-5 px-6"><div class="flex items-center gap-3"><div class="size-9 rounded-full bg-[#e7f3ec] flex items-center justify-center text-[#30e87a] font-bold text-xs border border-green-100">{{s.name.charAt(0)}}</div><span class="font-bold text-sm">{{s.name}}</span></div></td>
          <td class="py-5 px-6 text-sm font-mono text-gray-500">{{s.id}}</td>

          <td class="py-5 px-6">
            <input [(ngModel)]="s.timeIn" class="bg-transparent border border-transparent hover:border-gray-200 rounded px-2 py-1 text-sm font-mono focus:border-emerald-500 outline-none w-24 transition-colors" [class.text-red-500]="s.status === 'Late'">
          </td>

          <td class="py-5 px-6">
            <span [ngClass]="{'bg-green-100 text-green-700': s.status === 'Present', 'bg-pink-100 text-pink-700': s.status === 'Absent', 'bg-blue-100 text-blue-700': s.status === 'Late'}" class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-black uppercase"><span class="size-1.5 rounded-full" [ngClass]="{'bg-green-600': s.status === 'Present', 'bg-pink-600': s.status === 'Absent', 'bg-blue-600': s.status === 'Late'}"></span> {{s.status}}</span>
          </td>

          <td class="py-5 px-6 text-right">
            <div class="flex items-center justify-end gap-2">
              <button (click)="handleMC(s)" [class]="s.mcFile ? 'text-emerald-500 bg-emerald-50' : 'text-blue-400 hover:bg-blue-50'" class="p-2 rounded-xl transition-all" [title]="s.mcFile ? 'View/Download MC' : 'Upload MC'">
                <span class="material-symbols-outlined text-[20px]">{{ s.mcFile ? 'visibility' : 'upload_file' }}</span>
              </button>
              <button (click)="toggleStatus(s)" class="p-2 text-gray-400 hover:bg-green-50 hover:text-green-600 rounded-xl transition-all" title="Toggle Status"><span class="material-symbols-outlined text-[20px]">swap_horiz</span></button>
              <button (click)="deleteStudent(s.id)" class="p-2 text-gray-400 hover:bg-red-50 hover:text-red-500 rounded-xl transition-all" title="Delete Student"><span class="material-symbols-outlined text-[20px]">delete</span></button>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
      <div *ngIf="filteredStudents.length === 0" class="flex flex-col items-center justify-center h-64"><span class="material-symbols-outlined text-4xl text-gray-300">search_off</span><p class="text-gray-400 text-sm font-bold mt-2 uppercase tracking-wide">No students found</p></div>
    </div>

    <div class="mt-8 flex justify-end pb-12" *ngIf="filteredStudents.length > 0">
      <button (click)="submitChanges()" class="px-12 py-4 bg-[#30e87a] text-[#0e1b13] font-black uppercase tracking-widest rounded-full shadow-lg shadow-green-200 hover:scale-105 transition-all flex items-center gap-3 text-xs"><span class="material-symbols-outlined text-lg">save</span> Submit All Changes</button>
    </div>
  </div>
</div>
